<!--
    File: catalog.html
    Desc: The page that will display all available movies the user can add to their watchlist.
-->

<!-- TODO: STILL NEED TO ADD THE "ADD TO WATCHLIST" COLUMN WHICH WILL FLAG THE MOVIE IN THE USER'S PERSONAL CATALOG
        SO WE KNOW TO DISPLAY IT WHEN THEY VISIT THEIR WATCHLIST PAGE. -->


<!DOCTYPE html>
<html>
    <head>
        <title>Catalog</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <a href="./start.html">Log Out</a>
        <a href="./watchlist.html">Your Watchlist</a>
        <h1>Movie Catalog</h1>
        <h2>Browse and bookmark movies to add to your watchlist</h2>
        <table>
            <thead>
                <tr>
                    <th>Title</th><th>Genre</th><th>Description</th>
                </tr>
            </thead>
            <tbody id="myTable"></tbody>
        </table>

        <script>
            function fillTable() {
                // Get all the movies from the logged in user's catalog.json. (So we know the movies they haven't flagged.)
                const myParams = new URLSearchParams(window.location.search);
                const currentUser = myParams.get("user");
                fetch(`/databases/user_catalogs/${currentUser}_catalog.json`)
                    .then((response) => response.json())
                    .then(function(movieList) {
                        const myTable = document.getElementById("myTable");
                        // Loop over every movieObj, make a tr for it, put td in the tr and add it.
                        for (let i=0; i<movieList.length; i++) {
                            const movieObj = movieList[i];
                            // Only list it in the catalog if the movie is flagged FALSE (meaning user has not bookmarked it for watchlist.)
                            if (!movieObj.flagged) {
                                const row = document.createElement("tr");
                            row.innerHTML = `
                                <td>${movieObj.title}</td><td>${movieObj.genre}</td><td>${movieObj.description}</td>
                            `;
                            myTable.appendChild(row);
                            } 
                        }
                    })
                    .catch(error => console.error("There was an error fetching the catalog."));
            }
            fillTable();
        </script>
    </body>
</html>