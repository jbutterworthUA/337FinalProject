<!--
    File: watchlist.html
    Desc: Will show a table of the user's watchlist.
    To get this, we need to scan their personal catalog json for any obj ? flagged===true.
    If so, display it in the table, with the option to mark as watched which will set flagged===false
    and remove it from the watchlist table and place it back in the catalog.html table.
-->
<!DOCTYPE html>
<html>
    <head>
        <title>Watchlist</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div class="menu-bar">
            <a href="./start.html">Log Out</a>
            <a href="./catalog.html">Back to Catalog</a>
        </div>

        <h1>Your Watchlist</h1>

        <table>
            <tr>
                <th>Title</th><th>Genre</th><th>Description</th><th>Remove</th>
            </tr>
            <tbody id="watchlistTable"></tbody>
        </table>

        <script>
            function fillWatchlist() {
                const currentUser = localStorage.getItem("currentUser");

                fetch(`/databases/user_catalogs/${currentUser}_catalog.json`)
                    .then(res => res.json())
                    .then(catalog => {
                        const table = document.getElementById("watchlistTable");

                        for (let movie of catalog) {
                            if (movie.flagged) {
                                const row = document.createElement("tr");
                                
                                row.innerHTML = `
                                    <td>${movie.title}</td>
                                    <td>${movie.genre}</td>
                                    <td>${movie.description}</td>
                                    <td>
                                        <button onclick="removeFromWatchlist('${movie.title}')">
                                            Remove
                                        </button>
                                    </td>
                                `;

                                table.appendChild(row);
                            }
                        }
                    })
                    .catch(err => console.error("Error loading watchlist:", err));
            }

            fillWatchlist(); // call function
        </script>
    </body>
</html>